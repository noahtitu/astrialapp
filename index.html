<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Astrial</title>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Astrial">
<meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">
<style>
:root{
--bg:#0f172a;
--bg2:#1e1b4b;
--glass:rgba(255,255,255,0.06);
--glass-strong:rgba(255,255,255,0.12);
--accent:#8b5cf6;
--accent-soft:#a78bfa;
--text-soft:rgba(255,255,255,0.6);
--radius:22px;
--blur:24px;
}

*{
box-sizing:border-box;
margin:0;
padding:0;
}

body{
margin:0;
font-family:'Inter',-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
background: radial-gradient(circle at 20% 20%, #1e1b4b 0%, #0f172a 40%, #020617 100%);
color:white;
min-height:100vh;
overflow-x:hidden;
position:relative;
}

body::before{
content:"";
position:fixed;
top:0;
left:0;
width:200%;
height:200%;
background-image:
radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,.3), transparent),
radial-gradient(2px 2px at 200px 150px, rgba(255,255,255,.2), transparent),
radial-gradient(1px 1px at 400px 300px, rgba(255,255,255,.2), transparent);
animation:stars 80s linear infinite;
z-index:-1;
}

@keyframes stars{
from{transform:translate(0,0)}
to{transform:translate(-500px,-500px)}
}

header{
position:sticky;
top:0;
z-index:10;
padding:20px;
text-align:center;
font-size:24px;
font-weight:600;
letter-spacing:1px;
background:rgba(15,23,42,0.6);
backdrop-filter:blur(20px);
border-bottom:1px solid rgba(255,255,255,0.05);
}

nav{
display:flex;
justify-content:center;
gap:12px;
padding:15px;
flex-wrap:wrap;
}

nav button{
background:var(--glass);
border:1px solid rgba(255,255,255,0.05);
color:white;
padding:10px 20px;
border-radius:30px;
cursor:pointer;
transition:all .2s ease;
font-weight:500;
}

nav button:hover{
background:var(--accent);
transform:translateY(-2px);
}

section{
display:none;
max-width:820px;
margin:auto;
padding:20px;
animation:fade .35s ease;
}

.active{display:block;}

@keyframes fade{
from{opacity:0;transform:translateY(10px)}
to{opacity:1;transform:translateY(0)}
}

.card{
background:var(--glass);
backdrop-filter:blur(var(--blur));
border:1px solid rgba(255,255,255,0.05);
border-radius:var(--radius);
padding:20px;
margin:18px 0;
box-shadow:0 10px 30px rgba(0,0,0,0.35);
transition:.2s;
}

.card:hover{
transform:translateY(-3px);
}

.section-title{
margin-top:35px;
margin-bottom:10px;
font-size:12px;
letter-spacing:2px;
color:var(--text-soft);
text-transform:uppercase;
}

.week-nav{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:10px;
}

.nav-btn{
background:var(--glass);
border:none;
color:white;
width:42px;
height:42px;
border-radius:50%;
cursor:pointer;
font-size:18px;
transition:.2s;
}

.nav-btn:hover{
background:var(--accent);
}

.week-days{
display:flex;
gap:12px;
overflow-x:auto;
padding:10px 0;
scrollbar-width:none;
}

.week-days::-webkit-scrollbar{display:none;}

.day{
flex:1;
min-width:75px;
padding:16px;
border-radius:18px;
background:var(--glass);
text-align:center;
cursor:pointer;
transition:.2s;
font-weight:500;
}

.day:hover{
background:var(--glass-strong);
}

.day.active{
background:var(--accent);
}

input,textarea,select{
width:100%;
padding:12px;
margin:8px 0;
border:none;
border-radius:16px;
background:#1e293b;
color:white;
font-size:14px;
transition:.2s;
}

input:focus,textarea:focus{
outline:none;
box-shadow:0 0 0 2px var(--accent);
}

button.primary{
background:var(--accent);
border:none;
padding:12px;
border-radius:18px;
color:white;
cursor:pointer;
margin-top:10px;
width:100%;
font-weight:600;
transition:.2s;
}

button.primary:hover{
background:var(--accent-soft);
transform:translateY(-2px);
}

.small{
font-size:12px;
color:var(--text-soft);
cursor:pointer;
margin-right:12px;
transition:.2s;
}

.small:hover{
color:white;
}

.done{
opacity:0.45;
text-decoration:line-through;
}

header{
display:flex;
align-items:center;
justify-content:center;
gap:10px;
padding:22px;
font-size:24px;
font-weight:600;
letter-spacing:2px;
background:rgba(15,23,42,0.6);
backdrop-filter:blur(20px);
border-bottom:1px solid rgba(255,255,255,0.05);
}

nav button{
display:flex;
align-items:center;
gap:8px;
}

/* ===== GLOW ACTIVE CARD ===== */

.item-card{
position:relative;
transition:all .35s cubic-bezier(.4,0,.2,1);
}

.item-card.done{
opacity:0.85;
position:relative;
}

.item-card.done::after{
content:"";
position:absolute;
inset:-2px;
border-radius:22px;
box-shadow:
0 0 20px rgba(139,92,246,0.9),
0 0 50px rgba(139,92,246,0.7),
0 0 90px rgba(139,92,246,0.5);
animation:glowPulse 1.8s ease-in-out infinite alternate;
pointer-events:none;
}

@keyframes glowPulse{
from{opacity:.7}
to{opacity:1}
}

/* ===== PREMIUM SPACE CARDS ===== */

.item-card{
position:relative;
padding:20px;
border-radius:20px;
background:linear-gradient(145deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
border:1px solid rgba(255,255,255,0.05);
backdrop-filter:blur(18px);
transition:0.3s ease;
overflow:hidden;
}

.item-card:hover{
transform:translateY(-4px);
box-shadow:0 15px 40px rgba(0,0,0,0.5);
}

.item-header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:10px;
}

.item-left{
display:flex;
align-items:center;
gap:12px;
font-weight:600;
font-size:16px;
}

.item-icon{
font-size:18px;
opacity:0.9;
}

.item-stats{
display:flex;
flex-wrap:wrap;
gap:8px;
margin-top:6px;
}

.stat-badge{
background:rgba(139,92,246,0.2);
border:1px solid rgba(139,92,246,0.4);
padding:4px 10px;
border-radius:999px;
font-size:12px;
color:#c4b5fd;
}

textarea.note-field{
margin-top:14px;
background:rgba(0,0,0,0.3);
border:1px solid rgba(255,255,255,0.05);
border-radius:14px;
padding:10px;
resize:none;
min-height:60px;
}

input[type="checkbox"]{
width:18px;
height:18px;
accent-color:#8b5cf6;
cursor:pointer;
}

.completion-banner{
background:linear-gradient(90deg,#8b5cf6,#6366f1);
padding:14px;
border-radius:18px;
text-align:center;
font-weight:600;
margin-bottom:20px;
animation:fadeIn .6s ease;
box-shadow:0 0 25px rgba(139,92,246,.5);
}

button.primary,
.nav-btn,
.day{
transition:all .25s cubic-bezier(.4,0,.2,1);
}

button.primary:active,
.nav-btn:active,
.day:active{
transform:scale(.96);
}

textarea,
input{
transition:box-shadow .25s ease, transform .25s ease;
}

textarea:focus,
input:focus{
transform:scale(1.02);
}

#particles{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
z-index:-1;
pointer-events:none;
}

@media (max-width:768px){

section{
padding:15px;
}

.card,
.item-card{
padding:16px;
}

.week-days{
gap:8px;
}

.day{
min-width:65px;
padding:12px;
}

header{
font-size:20px;
padding:18px;
}

button.primary{
padding:14px;
font-size:15px;
}

textarea{
min-height:50px;
}

}

input[type="checkbox"]{
transition:all .2s ease;
}

input[type="checkbox"]:checked{
transform:scale(1.2);
}

/* ===== MINI DASHBOARD ===== */

.dashboard-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
gap:14px;
margin-bottom:20px;
}

/* ===== NEON STAT CARDS ===== */

.stat-card{
position:relative;
background:linear-gradient(145deg, rgba(139,92,246,0.15), rgba(139,92,246,0.05));
border:1px solid rgba(139,92,246,0.5);
padding:16px;
border-radius:18px;
text-align:center;
transition:.3s cubic-bezier(.4,0,.2,1);
overflow:hidden;
}

/* Halo lumineux anim√© */
.stat-card::before{
content:"";
position:absolute;
inset:0;
border-radius:18px;
box-shadow:
0 0 10px rgba(139,92,246,0.6),
0 0 25px rgba(139,92,246,0.5),
0 0 50px rgba(139,92,246,0.4);
opacity:.6;
animation:neonPulse 3s ease-in-out infinite alternate;
pointer-events:none;
}

/* Effet hover premium */
.stat-card:hover{
transform:translateY(-4px) scale(1.03);
box-shadow:
0 0 15px rgba(139,92,246,0.8),
0 0 35px rgba(139,92,246,0.6),
0 0 70px rgba(139,92,246,0.4);
}

/* Texte glow */
.stat-value{
font-size:22px;
font-weight:700;
margin-top:6px;
color:#fff;
text-shadow:
0 0 5px #8b5cf6,
0 0 10px #8b5cf6,
0 0 20px rgba(139,92,246,0.8);
}

.stat-label{
font-size:12px;
opacity:.8;
margin-top:4px;
letter-spacing:1px;
color:#c4b5fd;
}

/* Animation n√©on */
@keyframes neonPulse{
from{opacity:.4}
to{opacity:1}
}

.stat-card:hover{
transform:translateY(-3px);
box-shadow:0 10px 30px rgba(139,92,246,0.4);
}

.stat-value{
font-size:22px;
font-weight:700;
margin-top:6px;
}

.stat-label{
font-size:12px;
opacity:.7;
margin-top:4px;
letter-spacing:1px;
}

/* ===== PROGRESS BAR ===== */

.progress-container{
margin-top:8px;
height:6px;
background:rgba(255,255,255,0.1);
border-radius:10px;
overflow:hidden;
}

.progress-bar{
height:100%;
background:linear-gradient(90deg,#8b5cf6,#6366f1);
width:0%;
transition:width 1s cubic-bezier(.4,0,.2,1);
box-shadow:0 0 10px rgba(139,92,246,0.7);
}
</style>
</head>
<body>

<header>
<i data-lucide="sparkles"></i>
ASTRIAL
</header>

<nav>
<button onclick="show('planning')">
<i data-lucide="calendar"></i> Planning
</button>
<button onclick="show('menus')">
<i data-lucide="utensils"></i> Menus
</button>
<button onclick="show('seances')">
<i data-lucide="dumbbell"></i> S√©ances
</button>
</nav>

<section id="planning" class="active">
<div class="card">
    <div id="miniDashboard" class="dashboard-grid"></div>
<div class="week-nav">
<button class="nav-btn" onclick="changeWeek(-1)">‚Äπ</button>
<div id="weekLabel"></div>
<button class="nav-btn" onclick="changeWeek(1)">‚Ä∫</button>
</div>
<div class="week-days" id="weekDays"></div>
</div>
<div id="content"></div>
<canvas id="weeklyChart" style="margin-top:20px;"></canvas>
<div class="card">
<select id="menuSelect"></select>
<button class="primary" onclick="assignMenu()">Ajouter menu</button>
</div>

<div class="card">
<select id="seanceSelect"></select>
<button class="primary" onclick="assignSeance()">Ajouter musculation</button>
</div>

<div class="card">
<select id="cardioSelect"></select>
<button class="primary" onclick="assignCardio()">Ajouter cardio</button>
</div>
</section>

<section id="menus">
<div class="card">
<input id="menuName" placeholder="Nom menu">
<input id="mPetit" placeholder="Petit d√©jeuner">
<input id="mDej" placeholder="D√©jeuner">
<input id="mColl" placeholder="Collation">
<input id="mDin" placeholder="D√Æner">
<button class="primary" onclick="saveMenu()">Enregistrer</button>
</div>
<div id="menuList"></div>
</section>

<section id="seances">
<div class="section-title">Musculation</div>
<div class="card">
<input id="sName" placeholder="Nom s√©ance">
<input id="sExo" placeholder="Exercice">
<input id="sSeries" placeholder="S√©ries">
<input id="sReps" placeholder="Reps">
<input id="sPoids" placeholder="Poids">
<input id="sRest" placeholder="Repos (sec)">
<textarea id="sNote" placeholder="Note"></textarea>
<button class="primary" onclick="addTemp()">Ajouter exercice</button>
<button class="primary" onclick="saveSeance()">Enregistrer s√©ance</button>
</div>
<div id="seanceList"></div>

<div class="section-title">Cardio</div>
<div class="card">
<input id="cName" placeholder="Nom s√©ance">
<input id="cKm" placeholder="Distance (km)">
<input id="cTime" placeholder="Dur√©e (min)">
<input id="cPace" placeholder="Allure (min/km)">
<textarea id="cNote" placeholder="Note"></textarea>
<button class="primary" onclick="saveCardio()">Enregistrer cardio</button>
</div>
<div id="cardioList"></div>
</section>

<script>
let lastStreak=0;
 renderDashboard
 function renderDashboard(){

let streak=0;
let volume=0;
let cardioTime=0;
let completed=0;
let total=0;

/* CALCUL GLOBAL */
for(let k in data.jours){
let j=data.jours[k];

if(j.exercices){
j.exercices.forEach(e=>{
volume+=Number(e.series||0)*Number(e.reps||0);
if(e.done) completed++;
total++;
});
}

if(j.cardio){
j.cardio.forEach(c=>{
cardioTime+=Number(c.time||0);
if(c.done) completed++;
total++;
});
}
}

/* STREAK */
let currentDate=new Date();
while(true){
let key=currentDate.toISOString().split("T")[0];
let j=data.jours[key];

if(j && (
(j.exercices && j.exercices.some(e=>e.done)) ||
(j.cardio && j.cardio.some(c=>c.done))
)){
streak++;
currentDate.setDate(currentDate.getDate()-1);
}else{
break;
}
}

/* RECORD */
let best=localStorage.getItem("bestStreak") || 0;

if(streak>best){
best=streak;
localStorage.setItem("bestStreak",best);
}

/* PROGRESS */
let percent= total ? Math.round((completed/total)*100) : 0;

miniDashboard.innerHTML=`
<div class="stat-card">
üî•
<div class="stat-value">${streak}</div>
<div class="stat-label">STREAK</div>
</div>

<div class="stat-card">
üèÜ
<div class="stat-value">${best}</div>
<div class="stat-label">RECORD</div>
</div>

<div class="stat-card">
üìà
<div class="stat-value">${percent}%</div>
<div class="stat-label">COMPL√âTION</div>
<div class="progress-container">
<div class="progress-bar" style="width:${percent}%"></div>
</div>
</div>

<div class="stat-card">
üèãÔ∏è
<div class="stat-value">${volume}</div>
<div class="stat-label">VOLUME</div>
</div>

<div class="stat-card">
üèÉ
<div class="stat-value">${cardioTime}m</div>
<div class="stat-label">CARDIO</div>
</div>
`;
}

let data = JSON.parse(localStorage.getItem("astrialUltimate")) || {
jours:{},menus:{},seances:{},cardio:{}
};

let currentOffset=0;
let selectedDate=null;
let temp=[];

const save=()=>{
localStorage.setItem("astrialUltimate",JSON.stringify(data));
renderAll();
};

const show=id=>{
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
};

function renderWeek(){
let base=new Date();
base.setDate(base.getDate()+currentOffset*7);
let day=base.getDay();
let diff=day===0?-6:1-day;
let monday=new Date(base);
monday.setDate(base.getDate()+diff);

weekDays.innerHTML="";
weekLabel.innerText="Semaine du "+monday.toLocaleDateString('fr-FR');

for(let i=0;i<7;i++){
let current=new Date(monday);
current.setDate(monday.getDate()+i);
let key=current.toISOString().split("T")[0];

weekDays.innerHTML+=`
<div class="day" onclick="selectDay('${key}',this)">
${current.toLocaleDateString('fr-FR',{weekday:'short'})}<br>
${current.getDate()}/${current.getMonth()+1}
</div>`;
}
}

function changeWeek(dir){currentOffset+=dir;renderWeek();}

function selectDay(date,el){
selectedDate=date;
document.querySelectorAll('.day').forEach(d=>d.classList.remove('active'));
el.classList.add('active');
renderDay();
}

function renderDay(){
content.innerHTML="";
let j=data.jours[selectedDate];
if(!j)return;

/* Repas */
if(j.repas){
content.innerHTML+=`<div class="section-title">
<i data-lucide="utensils"></i> Alimentation
</div>`;
Object.entries(j.repas).forEach(([k,v])=>{
content.innerHTML+=`
<div class="item-card ${v.done?'done':''}">
<div class="item-header">
<div class="item-left">
<input type="checkbox" ${v.done?'checked':''}
onclick="toggleMeal('${k}')">
<span class="item-icon">üçΩ</span>
<span>${k}</span>
</div>
</div>

<div class="item-stats">
<span class="stat-badge">${v.text}</span>
</div>

<textarea class="note-field"
onchange="noteMeal('${k}',this.value)"
placeholder="Note repas...">${v.note||""}</textarea>
</div>`;
});
}

/* Muscu */
if(j.exercices){
content.innerHTML+=`<div class="section-title">
<i data-lucide="dumbbell"></i> Musculation
</div>`;
j.exercices.forEach((e,i)=>{
content.innerHTML+=`
<div class="item-card ${e.done?'done':''}">
<div class="item-header">
<div class="item-left">
<input type="checkbox" ${e.done?'checked':''}
onclick="toggleExo(${i})">
<span class="item-icon">üèãÔ∏è</span>
<span>${e.ex}</span>
</div>
</div>

<div class="item-stats">
<span class="stat-badge">${e.series} s√©ries</span>
<span class="stat-badge">${e.reps} reps</span>
<span class="stat-badge">${e.poids} kg</span>
<span class="stat-badge">${e.rest||0} sec</span>
</div>

<textarea class="note-field"
onchange="noteExo(${i},this.value)"
placeholder="Note personnelle...">${e.note||""}</textarea>
</div>`;
});
}

/* Cardio */
if(j.cardio){
content.innerHTML+=`<div class="section-title">
<i data-lucide="activity"></i> Cardio
</div>`;
j.cardio.forEach((c,i)=>{
content.innerHTML+=`
<div class="item-card ${c.done?'done':''}">
<div class="item-header">
<div class="item-left">
<input type="checkbox" ${c.done?'checked':''}
onclick="toggleCardio(${i})">
<span class="item-icon">üèÉ</span>
<span>${c.km} km</span>
</div>
</div>

<div class="item-stats">
<span class="stat-badge">${c.time} min</span>
<span class="stat-badge">${c.pace||""}</span>
</div>

<textarea class="note-field"
onchange="noteCardio(${i},this.value)"
placeholder="Note cardio...">${c.note||""}</textarea>
</div>`;
});
}
}

/* MENUS */
function saveMenu(){
data.menus[menuName.value]={
petitdej:mPetit.value,
dejeuner:mDej.value,
collation:mColl.value,
diner:mDin.value
};
menuName.value=mPetit.value=mDej.value=mColl.value=mDin.value="";
save();
}

function renderMenus(){
menuList.innerHTML="";
for(let m in data.menus){
menuList.innerHTML+=`
<div class="card">
<strong>${m}</strong>
<span class="small" onclick="editMenu('${m}')">Modifier</span>
<span class="small" onclick="deleteMenu('${m}')">Supprimer</span>
</div>`;
}
}

function editMenu(name){
let m=data.menus[name];
menuName.value=name;
mPetit.value=m.petitdej;
mDej.value=m.dejeuner;
mColl.value=m.collation;
mDin.value=m.diner;
}

function deleteMenu(name){delete data.menus[name];save();}

/* MUSCU */
function addTemp(){
temp.push({
ex:sExo.value,
series:sSeries.value,
reps:sReps.value,
poids:sPoids.value,
rest:sRest.value,
note:sNote.value
});
sExo.value=sSeries.value=sReps.value=sPoids.value=sRest.value=sNote.value="";
}

function saveSeance(){
data.seances[sName.value]=temp;
temp=[];
sName.value="";
save();
}

function renderSeances(){
seanceList.innerHTML="";

for(let s in data.seances){
let exercices=data.seances[s];

let html=`
<div class="card">
<strong>${s}</strong>
<span class="small" onclick="editSeance('${s}')">Modifier</span>
<span class="small" onclick="deleteSeance('${s}')">Supprimer</span>

<div id="edit-${s}" style="display:none;margin-top:10px;">
`;

exercices.forEach((e,i)=>{
html+=`
<div class="card">
<input id="edit-${s}-ex-${i}" value="${e.ex}">
<input id="edit-${s}-series-${i}" value="${e.series}">
<input id="edit-${s}-reps-${i}" value="${e.reps}">
<input id="edit-${s}-poids-${i}" value="${e.poids}">
<input id="edit-${s}-rest-${i}" value="${e.rest||''}">
<textarea id="edit-${s}-note-${i}">${e.note||""}</textarea>
</div>
`;
});

html+=`
<button class="primary" onclick="saveEditSeance('${s}')">Enregistrer</button>
</div>
</div>
`;

seanceList.innerHTML+=html;
}
}

function editSeance(name){
let el=document.getElementById("edit-"+name);
el.style.display="block";
}

function saveEditSeance(name){
let exercices=data.seances[name];

exercices.forEach((e,i)=>{
e.ex=document.getElementById(`edit-${name}-ex-${i}`).value;
e.series=document.getElementById(`edit-${name}-series-${i}`).value;
e.reps=document.getElementById(`edit-${name}-reps-${i}`).value;
e.poids=document.getElementById(`edit-${name}-poids-${i}`).value;
e.rest=document.getElementById(`edit-${name}-rest-${i}`).value;
e.note=document.getElementById(`edit-${name}-note-${i}`).value;
});

save();
}

function toggleDetail(name){
let el=document.getElementById("detail-"+name);
el.style.display=el.style.display==="none"?"block":"none";
}

function updateExo(s,i,k,v){data.seances[s][i][k]=v;save();}
function deleteExo(s,i){data.seances[s].splice(i,1);save();}
function addExoExisting(s){
data.seances[s].push({ex:"Nouvel exo",series:"",reps:"",poids:"",rest:"",note:""});
save();
}
function deleteSeance(name){delete data.seances[name];save();}

/* CARDIO */
function saveCardio(){
data.cardio[cName.value]={
km:cKm.value,time:cTime.value,
pace:cPace.value,note:cNote.value
};
cName.value=cKm.value=cTime.value=cPace.value=cNote.value="";
save();
}

function renderCardio(){
cardioList.innerHTML="";

for(let c in data.cardio){

let cardio=data.cardio[c];

let html=`
<div class="card">
<strong>${c}</strong>
<span class="small" onclick="editCardio('${c}')">Modifier</span>
<span class="small" onclick="deleteCardio('${c}')">Supprimer</span>

<div id="edit-cardio-${c}" style="display:none;margin-top:15px;">

<div class="card">
<input id="edit-${c}-km" value="${cardio.km}">
<input id="edit-${c}-time" value="${cardio.time}">
<input id="edit-${c}-pace" value="${cardio.pace||''}">
<textarea id="edit-${c}-note">${cardio.note||""}</textarea>
<button class="primary" onclick="saveEditCardio('${c}')">Enregistrer</button>
</div>

</div>
</div>
`;

cardioList.innerHTML+=html;
}
}

function editCardio(name){
let el=document.getElementById("edit-cardio-"+name);
el.style.display="block";
}

function saveEditCardio(name){
data.cardio[name].km=document.getElementById(`edit-${name}-km`).value;
data.cardio[name].time=document.getElementById(`edit-${name}-time`).value;
data.cardio[name].pace=document.getElementById(`edit-${name}-pace`).value;
data.cardio[name].note=document.getElementById(`edit-${name}-note`).value;
save();
}

function toggleCardioDetail(name){
let el=document.getElementById("cardio-"+name);
el.style.display=el.style.display==="none"?"block":"none";
}

function updateCardio(n,k,v){data.cardio[n][k]=v;save();}
function deleteCardio(n){delete data.cardio[n];save();}

/* ASSIGN */
function assignMenu(){
let base=data.menus[menuSelect.value];
if(!base||!selectedDate)return;
data.jours[selectedDate]=data.jours[selectedDate]||{};
data.jours[selectedDate].repas={
petitdej:{text:base.petitdej,done:false,note:""},
dejeuner:{text:base.dejeuner,done:false,note:""},
collation:{text:base.collation,done:false,note:""},
diner:{text:base.diner,done:false,note:""}
};
save();
}

function assignSeance(){
let base=data.seances[seanceSelect.value];
if(!base||!selectedDate)return;
data.jours[selectedDate]=data.jours[selectedDate]||{};
data.jours[selectedDate].exercices=base.map(e=>({...e,done:false}));
save();
}

function assignCardio(){
let base=data.cardio[cardioSelect.value];
if(!base||!selectedDate)return;
data.jours[selectedDate]=data.jours[selectedDate]||{};
data.jours[selectedDate].cardio=[{...base,done:false}];
save();
}

/* TOGGLE */
function toggleMeal(t){data.jours[selectedDate].repas[t].done^=1;save();}
function noteMeal(t,v){data.jours[selectedDate].repas[t].note=v;save();}
function toggleExo(i){data.jours[selectedDate].exercices[i].done^=1;save();}
function noteExo(i,v){data.jours[selectedDate].exercices[i].note=v;save();}
function toggleCardio(i){data.jours[selectedDate].cardio[i].done^=1;save();}
function noteCardio(i,v){data.jours[selectedDate].cardio[i].note=v;save();}

/* SELECTS */
function updateSelects(){
menuSelect.innerHTML=Object.keys(data.menus).map(m=>`<option>${m}</option>`).join("");
seanceSelect.innerHTML=Object.keys(data.seances).map(s=>`<option>${s}</option>`).join("");
cardioSelect.innerHTML=Object.keys(data.cardio).map(c=>`<option>${c}</option>`).join("");
}

function checkCompletion(){
if(!selectedDate) return;
let j=data.jours[selectedDate];
if(!j) return;

let allDone=true;

if(j.exercices){
j.exercices.forEach(e=>{if(!e.done) allDone=false});
}
if(j.cardio){
j.cardio.forEach(c=>{if(!c.done) allDone=false});
}

let badge=document.getElementById("completionBadge");

if(allDone && (j.exercices||j.cardio)){
if(!badge){
content.innerHTML=`
<div id="completionBadge" class="completion-banner">
‚ú® S√©ance termin√©e ‚Äî Excellent travail !
</div>` + content.innerHTML;
}
}
}

function renderWeeklyChart(){

let labels=[];
let dataPoints=[];

let base=new Date();
let day=base.getDay();
let diff=day===0?-6:1-day;
let monday=new Date(base);
monday.setDate(base.getDate()+diff);

for(let i=0;i<7;i++){
let d=new Date(monday);
d.setDate(monday.getDate()+i);
let key=d.toISOString().split("T")[0];

labels.push(d.toLocaleDateString('fr-FR',{weekday:'short'}));

let j=data.jours[key];
let count=0;

if(j){
if(j.exercices) count+=j.exercices.filter(e=>e.done).length;
if(j.cardio) count+=j.cardio.filter(c=>c.done).length;
}

dataPoints.push(count);
}

let ctx=document.getElementById("weeklyChart");

new Chart(ctx,{
type:"line",
data:{
labels:labels,
datasets:[{
data:dataPoints,
borderColor:"#8b5cf6",
backgroundColor:"rgba(139,92,246,0.2)",
tension:0.4,
fill:true
}]
},
options:{
plugins:{legend:{display:false}},
scales:{
x:{display:true},
y:{display:false}
}
}
});
}

function animateStreak(){
let el=document.querySelector(".stat-card");
if(!el) return;

el.style.transform="scale(1.2)";
el.style.boxShadow="0 0 40px rgba(255,140,0,0.9)";

setTimeout(()=>{
el.style.transform="scale(1)";
el.style.boxShadow="";
},600);
}

function renderAll(){
renderMenus();
renderSeances();
renderCardio();
updateSelects();
renderDay();
renderWeeklyChart();
renderDashboard();
checkCompletion();
lucide.createIcons();
}

renderWeek();
renderAll();
/* ===== PARTICULES FIX ===== */

window.addEventListener("load", function(){

const canvas=document.getElementById("particles");
if(!canvas) return;

const ctx=canvas.getContext("2d");

function resize(){
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

let particles=[];

for(let i=0;i<80;i++){
particles.push({
x:Math.random()*canvas.width,
y:Math.random()*canvas.height,
r:Math.random()*2+0.5,
d:Math.random()*0.6+0.2
});
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.fillStyle="rgba(139,92,246,0.8)";

particles.forEach(p=>{
ctx.beginPath();
ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
ctx.fill();
});

update();
requestAnimationFrame(draw);
}

function update(){
particles.forEach(p=>{
p.y+=p.d;
if(p.y>canvas.height){
p.y=0;
p.x=Math.random()*canvas.width;
}
});
}

draw();

});

</script>
<canvas id="particles"></canvas>
</body>

</html>
